<?phpclass adminuser extends Controller {    function __construct() {        parent::__construct();        Useraccess::access_control('isuser', 'index#loginlink', 4);    }    public function index() {        $this->loadusers();        $this->view->render('adminuser/index', $this->data);    }    public function loadbanuser() {        $banuser = '';        //count of users        $cond = 'isban=1 Limit 12';        $res = $this->model->countofuser($cond);        if ($res != FALSE) {            $cnt = $res->rowCount();        } else {            $cnt = 0;        }        //load users        $cond = 'isban=1 Limit 12';        $res = $this->model->loadusers($cond);        if ($res != FALSE) {            while ($row = $res->fetch()) {                $username = $row['name'] . ' ' . $row['family'];                if ($username != ' ') {                    $username = htmlspecialchars($username);                } else {                    $username = htmlspecialchars($row['username']);                }                if ($row['isavatar'] == 1) {                    $imgname = Utilities::imgname('avatar', $row['id']) . '.jpg';                    $vatar = URL . '/images/avatar/' . $imgname;                } else {                    $imgname = Utilities::imgname('avatar', 'default') . '.jpg';                    $vatar = URL . '/images/avatar/' . $imgname;                }                //user role                $role = '';                switch ($row['isadmin']) {                    case 1:                        $role = 'کاربر عادی';                        break;                    case 2:                        $role = 'داور';                        break;                    case 3:                        $role = 'بازبین';                        break;                    case 4:                        $role = 'ادمین';                        break;                }                $banuser .= '<div class="col s12 m3 right">                        <div class="card"  id="' . $row['id'] . '">                            <div class="card-image">                                <img src="' . $vatar . '">                                <span class="card-title teal-text text-darken-3">' . $username . '</span>                            </div>                            <div class="card-content" id="divinf">                                <div class="id none">' . $row['id'] . '</div>                                <div class="role none">' . $row['isadmin'] . '</div>                                <div class="infus left en">IP : <span>' . $row['loginip'] . '</span></div>                                <div class="infus" id="status">وضعیت : <span>' . $role . '</span></div>                                <div class="infus">عکس ها : <span>' . htmlspecialchars($row['photonumber']) . '</span></div>                                <div class="infus">کد ملی : <span>' . $row['melicode'] . '</span></div>                                <div class="infus">نام کاربری : <span>' . htmlspecialchars($row['username']) . '</span></div>                                <div class="infus">ایمیل : <span class="en">' . htmlspecialchars($row['mail']) . '</span></div>                                <div class="infus none codem">' . $row['melicode'] . '</div>                                <div class="infus none tel">' . htmlspecialchars($row['tel']) . '</div>                                <div class="infus none addr">' . htmlspecialchars(str_replace(PHP_EOL, '<br>', $row['address'])) . '</div>                                <div class="infus none codp">' . $row['postcode'] . '</div>                            </div>                            <div class="card-action">                                <a class="notbanuser waves-effect waves-light btn left blue-grey darken-2"><i class="mdi-action-cached right"></i>فعال کردن</a>                                <a class="moreinf tooltipped" data-position="bottom" data-delay="50" data-tooltip="اطلاعات بیشتر"><i class="mdi-navigation-more-vert small grey-text text-darken-4 right"></i></a>                            </div>                        </div>                    </div>';            }            $this->view->render('adminuser/index', $banuser,FALSE,0);        }    }    public function loadactusers() {        $actuser='';        $cond = 'confirm=1 AND isban=0 Limit 12';        $res = $this->model->countofuser($cond);        if ($res != FALSE) {            $cnt = $res->rowCount();        } else {            $cnt = 0;        }        //load users        $cond = 'confirm=1 AND isban=0 Limit 12';        $res = $this->model->loadusers($cond);        if ($res != FALSE) {            while ($row = $res->fetch()) {                $username = htmlspecialchars($row['name']) . ' ' . htmlspecialchars($row['family']);                if ($username != ' ') {                    $username = htmlspecialchars($username);                } else {                    $username = htmlspecialchars($row['username']);                }                if ($row['isavatar'] == 1) {                    $imgname = Utilities::imgname('avatar', $row['id']) . '.jpg';                    $vatar = URL . '/images/avatar/' . $imgname;                } else {                    $imgname = Utilities::imgname('avatar', 'default') . '.jpg';                    $vatar = URL . '/images/avatar/' . $imgname;                }                //user role                $role = '';                switch ($row['isadmin']) {                    case 1:                        $role = 'کاربر عادی';                        break;                    case 2:                        $role = 'داور';                        break;                    case 3:                        $role = 'بازبین';                        break;                    case 4:                        $role = 'ادمین';                        break;                }                $actuser.= '<div class="col s12 m3 right">                        <div class="card" id="' . $row['id'] . '">                            <div class="card-image">                                <img src="' . $vatar . '">                                <span class="card-title teal-text text-darken-3">' . $username . '</span>                            </div>                            <div class="card-content" id="divinf">                                <div class="id none">' . $row['id'] . '</div>                                <div class="role none">' . $row['isadmin'] . '</div>                                <div class="infus left en">IP : <span>' . $row['loginip'] . '</span></div>                                <div class="infus" id="status">وضعیت : <span>' . $role . '</span></div>                                <div class="infus">عکس ها : <span>' . $row['photonumber'] . '</span></div>                                <div class="infus">کد ملی : <span>' . $row['melicode'] . '</span></div>                                <div class="infus">نام کاربری : <span>' . htmlspecialchars($row['username']) . '</span></div>                                <div class="infus">ایمیل : <span class="en">' . htmlspecialchars($row['mail']) . '</span></div>                                <div class="infus none codem">' . $row['melicode'] . '</div>                                <div class="infus none tel">' . htmlspecialchars($row['tel']) . '</div>                                <div class="infus none addr">' . htmlspecialchars(str_replace(PHP_EOL, '<br>', $row['address'])) . '</div>                                <div class="infus none codp">' . htmlspecialchars($row['postcode']) . '</div>                            </div>                            <div class="card-action">                                <a class="banuser waves-effect waves-light btn left pink darken-3"><i class="mdi-action-delete right"></i>حذف</a>                                <a class="moreinf tooltipped" data-position="bottom" data-delay="50" data-tooltip="اطلاعات بیشتر"><i class="mdi-navigation-more-vert small grey-text text-darken-4 right"></i></a>                            </div>                        </div>                    </div>';            }            $this->view->render('adminuser/index', $actuser,FALSE,0);        }    }    public function loadusers() {        $this->data['[VARGALIMAGES]'] = '';        $this->data['[VARIMAGECOUNT]'] = '';        //count of users        $cond = 'confirm=1 AND isban=0 Limit 12';        $res = $this->model->countofuser($cond);        if ($res != FALSE) {            $cnt = $res->rowCount();        } else {            $cnt = 0;        }        $numofpage = ceil($cnt / 12);        $this->data['[VARIMAGECOUNT]'] = $numofpage;        //load users        $cond = 'confirm=1 AND isban=0 Limit 12';        $res = $this->model->loadusers($cond);        if ($res != FALSE) {            while ($row = $res->fetch()) {                $username = htmlspecialchars($row['name']) . ' ' . htmlspecialchars($row['family']);                if ($username != ' ') {                    $username = htmlspecialchars($username);                } else {                    $username = htmlspecialchars($row['username']);                }                if ($row['isavatar'] == 1) {                    $imgname = Utilities::imgname('avatar', $row['id']) . '.jpg';                    $vatar = URL . '/images/avatar/' . $imgname;                } else {                    $imgname = Utilities::imgname('avatar', 'default') . '.jpg';                    $vatar = URL . '/images/avatar/' . $imgname;                }                //user role                $role = '';                switch ($row['isadmin']) {                    case 1:                        $role = 'کاربر عادی';                        break;                    case 2:                        $role = 'داور';                        break;                    case 3:                        $role = 'بازبین';                        break;                    case 4:                        $role = 'ادمین';                        break;                }                $this->data['[VARGALIMAGES]'] .= '<div class="col s12 m3 right">                        <div class="card" id="' . $row['id'] . '">                            <div class="card-image">                                <img src="' . $vatar . '">                                <span class="card-title teal-text text-darken-3">' . $username . '</span>                            </div>                            <div class="card-content" id="divinf">                                <div class="id none">' . $row['id'] . '</div>                                <div class="role none">' . $row['isadmin'] . '</div>                                <div class="infus left en">IP : <span>' . $row['loginip'] . '</span></div>                                <div class="infus" id="status">وضعیت : <span>' . $role . '</span></div>                                <div class="infus">عکس ها : <span>' . $row['photonumber'] . '</span></div>                                <div class="infus">کد ملی : <span>' . $row['melicode'] . '</span></div>                                <div class="infus">نام کاربری : <span>' . htmlspecialchars($row['username']) . '</span></div>                                <div class="infus">ایمیل : <span class="en">' . htmlspecialchars($row['mail']) . '</span></div>                                <div class="infus none codem">' . $row['melicode'] . '</div>                                <div class="infus none tel">' . htmlspecialchars($row['tel']) . '</div>                                <div class="infus none addr">' . htmlspecialchars(str_replace(PHP_EOL, '<br>', $row['address'])) . '</div>                                <div class="infus none codp">' . htmlspecialchars($row['postcode']) . '</div>                            </div>                            <div class="card-action">                                <a class="banuser waves-effect waves-light btn left pink darken-3"><i class="mdi-action-delete right"></i>حذف</a>                                <a class="moreinf tooltipped" data-position="bottom" data-delay="50" data-tooltip="اطلاعات بیشتر"><i class="mdi-navigation-more-vert small grey-text text-darken-4 right"></i></a>                            </div>                        </div>                    </div>';            }        }        //load baned users        $this->data['[VARBANEDUSERS]'] = '';        $this->data['[VARUSEROKIMAGECOUNT]'] = '';        //count of users        $cond = 'isban=1 Limit 12';        $res = $this->model->countofuser($cond);        if ($res != FALSE) {            $cnt = $res->rowCount();        } else {            $cnt = 0;        }        $numofpage = ceil($cnt / 12);        $this->data['[VARUSEROKIMAGECOUNT]'] = $numofpage;        //load users        $cond = 'isban=1 Limit 12';        $res = $this->model->loadusers($cond);        if ($res != FALSE) {            while ($row = $res->fetch()) {                $username = $row['name'] . ' ' . $row['family'];                if ($username != ' ') {                    $username = htmlspecialchars($username);                } else {                    $username = htmlspecialchars($row['username']);                }                if ($row['isavatar'] == 1) {                    $imgname = Utilities::imgname('avatar', $row['id']) . '.jpg';                    $vatar = URL . '/images/avatar/' . $imgname;                } else {                    $imgname = Utilities::imgname('avatar', 'default') . '.jpg';                    $vatar = URL . '/images/avatar/' . $imgname;                }                //user role                $role = '';                switch ($row['isadmin']) {                    case 1:                        $role = 'کاربر عادی';                        break;                    case 2:                        $role = 'داور';                        break;                    case 3:                        $role = 'بازبین';                        break;                    case 4:                        $role = 'ادمین';                        break;                }                $this->data['[VARBANEDUSERS]'] .= '<div class="col s12 m3 right">                        <div class="card"  id="' . $row['id'] . '">                            <div class="card-image">                                <img src="' . $vatar . '">                                <span class="card-title teal-text text-darken-3">' . $username . '</span>                            </div>                            <div class="card-content" id="divinf">                                <div class="id none">' . $row['id'] . '</div>                                <div class="role none">' . $row['isadmin'] . '</div>                                <div class="infus left en">IP : <span>' . $row['loginip'] . '</span></div>                                <div class="infus" id="status">وضعیت : <span>' . $role . '</span></div>                                <div class="infus">عکس ها : <span>' . htmlspecialchars($row['photonumber']) . '</span></div>                                <div class="infus">کد ملی : <span>' . $row['melicode'] . '</span></div>                                <div class="infus">نام کاربری : <span>' . htmlspecialchars($row['username']) . '</span></div>                                <div class="infus">ایمیل : <span class="en">' . htmlspecialchars($row['mail']) . '</span></div>                                <div class="infus none codem">' . $row['melicode'] . '</div>                                <div class="infus none tel">' . htmlspecialchars($row['tel']) . '</div>                                <div class="infus none addr">' . htmlspecialchars(str_replace(PHP_EOL, '<br>', $row['address'])) . '</div>                                <div class="infus none codp">' . $row['postcode'] . '</div>                            </div>                            <div class="card-action">                                <a class="notbanuser waves-effect waves-light btn left blue-grey darken-2"><i class="mdi-action-cached right"></i>فعال کردن</a>                                <a class="moreinf tooltipped" data-position="bottom" data-delay="50" data-tooltip="اطلاعات بیشتر"><i class="mdi-navigation-more-vert small grey-text text-darken-4 right"></i></a>                            </div>                        </div>                    </div>';            }        }    }    public function paging() {        $returndata = '';        $fields = array('idxid', 'pgid');        //check isset        if (Checkform::checkset($_POST, $fields)) {            //check not empty            if (Checkform::checknotempty($_POST, $fields)) {                switch ($_POST['idxid']) {                    case 1:                        //all ok users                        $lmt = 12 * ($_POST['pgid'] - 1);                        //load users                        $cond = 'confirm=1 AND isban=0 Limit ' . $lmt . ',12';                        $res = $this->model->loadusers($cond);                        if ($res != FALSE) {                            while ($row = $res->fetch()) {                                $username = $row['name'] . ' ' . $row['family'];                                if ($username != ' ') {                                    $username = htmlspecialchars($username);                                } else {                                    $username = htmlspecialchars($row['username']);                                }                                if ($row['isavatar'] == 1) {                                    $imgname = Utilities::imgname('avatar', $row['id']) . '.jpg';                                    $vatar = URL . '/images/avatar/' . $imgname;                                } else {                                    $imgname = Utilities::imgname('avatar', 'default') . '.jpg';                                    $vatar = URL . '/images/avatar/' . $imgname;                                }                                //user role                                $role = '';                                switch ($row['isadmin']) {                                    case 1:                                        $role = 'کاربر عادی';                                        break;                                    case 2:                                        $role = 'داور';                                        break;                                    case 3:                                        $role = 'بازبین';                                        break;                                    case 4:                                        $role = 'ادمین';                                        break;                                }                                $returndata .= '<div class="col s12 m3 right">                        <div class="card"  id="' . $row['id'] . '">                            <div class="card-image">                                <img src="' . $vatar . '">                                <span class="card-title teal-text text-darken-3">' . $username . '</span>                            </div>                            <div class="card-content" id="divinf">                                <div class="id none">' . $row['id'] . '</div>                                <div class="role none">' . $row['isadmin'] . '</div>                                <div class="infus left en">IP : <span>' . $row['loginip'] . '</span></div>                                <div class="infus" id="status">وضعیت : <span>' . $role . '</span></div>                                <div class="infus">عکس ها : <span>' . htmlspecialchars($row['photonumber']) . '</span></div>                                <div class="infus">کد ملی : <span>' . $row['melicode'] . '</span></div>                                <div class="infus">نام کاربری : <span>' . htmlspecialchars($row['username']) . '</span></div>                                <div class="infus">ایمیل : <span class="en">' . htmlspecialchars($row['mail']) . '</span></div>                                <div class="infus none codem">' . $row['melicode'] . '</div>                                <div class="infus none tel">' . htmlspecialchars($row['tel']) . '</div>                                <div class="infus none addr">' . htmlspecialchars(str_replace(PHP_EOL, '<br>', $row['address'])) . '</div>                                <div class="infus none codp">' . $row['postcode'] . '</div>                            </div>                            <div class="card-action">                                <a class="banuser waves-effect waves-light btn left pink darken-3"><i class="mdi-action-delete right"></i>حذف</a>                                <a class="moreinf tooltipped" data-position="bottom" data-delay="50" data-tooltip="اطلاعات بیشتر"><i class="mdi-navigation-more-vert small grey-text text-darken-4 right"></i></a>                            </div>                        </div>                    </div>';                            }                        }                        break;                    case 2:                        //all baned user                        $lmt = 12 * ($_POST['pgid'] - 1);                        //load users                        $cond = 'isban=1 Limit ' . $lmt . ',12';                        $res = $this->model->loadusers($cond);                        if ($res != FALSE) {                            while ($row = $res->fetch()) {                                $username = $row['name'] . ' ' . $row['family'];                                if ($username != ' ') {                                    $username = htmlspecialchars($username);                                } else {                                    $username = htmlspecialchars($row['username']);                                }                                if ($row['isavatar'] == 1) {                                    $imgname = Utilities::imgname('avatar', $row['id']) . '.jpg';                                    $vatar = URL . '/images/avatar/' . $imgname;                                } else {                                    $imgname = Utilities::imgname('avatar', 'default') . '.jpg';                                    $vatar = URL . '/images/avatar/' . $imgname;                                }                                //user role                                $role = '';                                switch ($row['isadmin']) {                                    case 1:                                        $role = 'کاربر عادی';                                        break;                                    case 2:                                        $role = 'داور';                                        break;                                    case 3:                                        $role = 'بازبین';                                        break;                                    case 4:                                        $role = 'ادمین';                                        break;                                }                                $returndata .= '<div class="col s12 m3 right">                        <div class="card"  id="' . $row['id'] . '">                            <div class="card-image">                                <img src="' . $vatar . '">                                <span class="card-title teal-text text-darken-3">' . $username . '</span>                            </div>                            <div class="card-content" id="divinf">                                <div class="id none">' . $row['id'] . '</div>                                <div class="role none">' . $row['isadmin'] . '</div>                                <div class="infus left en">IP : <span>' . $row['loginip'] . '</span></div>                                <div class="infus" id="status">وضعیت : <span>' . $role . '</span></div>                                <div class="infus">عکس ها : <span>' . htmlspecialchars($row['photonumber']) . '</span></div>                                <div class="infus">کد ملی : <span>' . $row['melicode'] . '</span></div>                                <div class="infus">نام کاربری : <span>' . htmlspecialchars($row['username']) . '</span></div>                                <div class="infus">ایمیل : <span class="en">' . htmlspecialchars($row['mail']) . '</span></div>                                <div class="infus none codem">' . $row['melicode'] . '</div>                                <div class="infus none tel">' . htmlspecialchars($row['tel']) . '</div>                                <div class="infus none addr">' . htmlspecialchars(str_replace(PHP_EOL, '<br>', $row['address'])) . '</div>                                <div class="infus none codp">' . $row['postcode'] . '</div>                            </div>                            <div class="card-action">                                <a class="notbanuser waves-effect waves-light btn left blue-grey darken-2"><i class="mdi-action-cached right"></i>فعال کردن</a>                                <a class="moreinf tooltipped" data-position="bottom" data-delay="50" data-tooltip="اطلاعات بیشتر"><i class="mdi-navigation-more-vert small grey-text text-darken-4 right"></i></a>                            </div>                        </div>                    </div>';                            }                        }                        break;                }            }        }//        $data = array('id' => '1', 'msg' => $returndata);//        $data = json_encode($data);        $this->view->render('adminuser/index', $returndata, false, 0);        return FALSE;    }    public function makeban() {        $msgid = 0;        $fields = array('userid');        //check isset        if (Checkform::checkset($_POST, $fields)) {            //check not empty            if (Checkform::checknotempty($_POST, $fields)) {                $cond = 'id=:id';                $data = array('id' => $_POST['userid']);                $result = $this->model->loadusers($cond, $data);                if ($result != FALSE) {                    $row = $result->fetch();                    //check user role                    if ($row['isadmin'] < Session::get('isuser')) {                        $cond = 'id=:id';                        $data = array('id' => $_POST['userid']);                        $this->model->makeban($cond, $data);                        //bazbin & davar check                        if ($row['isadmin'] == 3) {                            $co1 = 'bazid=:bz';                            $da1 = array('bz' => $_POST['userid']);                            $this->model->updateph($co1, $da1);                        } elseif ($row['isadmin'] == 2) {                            $co2 = 'isopen<2 AND did=:did';                            $da2 = array('did' => $_POST['userid']);                            $res2 = $this->model->checkcompopen($co2, $da2);                            if ($res2) {                                $comps = array();                                $i = 0;                                $co3 = '';                                while ($row2 = $res2->fetch()) {                                    $comps['c' . $i] = $row2['cid'];                                    $co3.='compid=:c' . $i . ' OR ';                                    $i++;                                }                                $co3 = substr($co3, 0, strlen($co3) - 3);                                $co3.='AND did=:did';                                if (sizeof($comps) != 0) {                                    $comps['did'] = $_POST['userid'];                                    $this->model->deldavarrows($co3, $comps);                                }                            }                        }                        $msgid = 1;                    } else {                        $msgid = 0;                    }                } else {                    $msgid = 0;                }            }        }        $data = array('id' => $msgid);        $data = json_encode($data);        $this->view->render('adminuser/index', $data, false, 0);        return FALSE;    }    public function makeunban() {        $msgid = 0;        $fields = array('userid');        //check isset        if (Checkform::checkset($_POST, $fields)) {            //check not empty            if (Checkform::checknotempty($_POST, $fields)) {                $cond = 'id=:id';                $data = array('id' => $_POST['userid']);                $result = $this->model->loadusers($cond, $data);                if ($result != FALSE) {                    $row = $result->fetch();                    //check user role                    if ($row['isadmin'] < Session::get('isuser')) {                        $cond = 'id=:id';                        $data = array('id' => $_POST['userid']);                        $this->model->makeunban($cond, $data);                        $msgid = 1;                    } else {                        $msgid = 0;                    }                } else {                    $msgid = 0;                }            }        }        $data = array('id' => $msgid);        $data = json_encode($data);        $this->view->render('adminuser/index', $data, false, 0);        return FALSE;    }    public function changerole() {        $msgid = 0;        $msgtxt = '';        $fields = array('id', 'role');        //check isset        if (Checkform::checkset($_POST, $fields)) {            //check not empty            if (Checkform::checknotempty($_POST, $fields)) {                $cond = 'id=:id';                $data = array('id' => $_POST['id']);                $result = $this->model->loadusers($cond, $data);                if ($result != FALSE) {                    $row = $result->fetch();                    //check user role                    if ($row['isadmin'] < Session::get('isuser')) {                        if ($_POST['role'] < Session::get('isuser')) {                            $cond = 'id=:id';                            $data = array('id' => $_POST['id']);                            $this->model->updaterole($cond, $_POST['role'], $data);                            switch ($_POST['role']) {                                case 1:                                    $role = 'کاربر عادی';                                    break;                                case 2:                                    $role = 'داور';                                    break;                                case 3:                                    $role = 'بازبین';                                    break;                                case 4:                                    $role = 'ادمین';                                    break;                            }                            $msgid = 1;                            $msgtxt = 'تغییر سطح کاربری با موفقیت انجام شد.';                            //bazbin & davar check                            if ($row['isadmin'] == 3) {                                $co1 = 'bazid=:bz';                                $da1 = array('bz' => $_POST['id']);                                $this->model->updateph($co1, $da1);                            } elseif ($row['isadmin'] == 2) {                                $co2 = 'isopen<2 AND did=:did';                                $da2 = array('did' => $_POST['id']);                                $res2 = $this->model->checkcompopen($co2, $da2);                                if ($res2) {                                    $comps = array();                                    $i = 0;                                    $co3 = '';                                    while ($row2 = $res2->fetch()) {                                        $comps['c' . $i] = $row2['cid'];                                        $co3.='compid=:c' . $i . ' OR ';                                        $i++;                                    }                                    $co3 = substr($co3, 0, strlen($co3) - 3);                                    $co3.='AND did=:did';                                    if (sizeof($comps) != 0) {                                        $comps['did'] = $_POST['id'];                                        $this->model->deldavarrows($co3, $comps);                                    }                                }                            }                        } else {                            $role = '';                            $msgid = 0;                            $msgtxt = 'سطح کاربری شما مجاز به انجام این عملیات نمی باشد!';                        }                    } else {                        $role = '';                        $msgid = 0;                        $msgtxt = 'سطح کاربری شما مجاز به انجام این عملیات نمی باشد!';                    }                } else {                    $role = '';                    $msgid = 0;                    $msgtxt = 'کاربر درخواستی یافت نشد!';                }            }        }        $data = array('id' => $msgid, 'msg' => $msgtxt, 'role' => $role, 'roleid' => $_POST['role']);        $data = json_encode($data);        $this->view->render('adminuser/index', $data, false, 0);        return FALSE;    }    public function searchuser() {        $msgid = 0;        $msgtxt = '';        $fields = array('searchuser');        //check isset        if (Checkform::checkset($_POST, $fields)) {            //check not empty            if (Checkform::checknotempty($_POST, $fields)) {                $cond = "name LIKE :name OR username LIKE :username";                $data = array('name' => '%' . $_POST['searchuser'] . '%', 'username' => '%' . $_POST['searchuser'] . '%');                $result = $this->model->searchusers($cond, $data);                if ($result != FALSE) {                    while ($row = $result->fetch()) {                        $username = $row['name'] ;                        if ($username != ' ') {                            $username = htmlspecialchars($username);                        } else {                            $username = htmlspecialchars($row['username']);                        }                        if ($row['isavatar'] == 1) {                            $imgname = Utilities::imgname('avatar', $row['id']) . '.jpg';                            $vatar = URL . '/images/avatar/' . $imgname;                        } else {                            $imgname = Utilities::imgname('avatar', 'default') . '.jpg';                            $vatar = URL . '/images/avatar/' . $imgname;                        }                        //user role                        $role = '';                        switch ($row['isadmin']) {                            case 1:                                $role = 'کاربر عادی';                                break;                            case 2:                                $role = 'داور';                                break;                            case 3:                                $role = 'بازبین';                                break;                            case 4:                                $role = 'ادمین';                                break;                        }                        //user ban?                        $isban = '';                        switch ($row['isban']) {                            case 0:                                $isban = '<a class="banuser waves-effect waves-light btn left pink darken-3"><i class="mdi-action-delete right"></i>حذف</a>';                                break;                            case 1:                                $isban = '<a class="notbanuser waves-effect waves-light btn left blue-grey darken-2"><i class="mdi-action-cached right"></i>فعال کردن</a>';                                break;                        }                        $msgtxt.= '<div class="col s12 m3 right">                        <div class="card"  id="' . $row['id'] . '">                            <div class="card-image">                                <img src="' . $vatar . '">                                <span class="card-title teal-text text-darken-3">' . $username . '</span>                            </div>                            <div class="card-content" id="divinf">                                <div class="id none">' . $row['id'] . '</div>                                <div class="role none">' . $row['isadmin'] . '</div>                                <div class="infus left en">IP : <span>' . $row['loginip'] . '</span></div>                                <div class="infus" id="status">وضعیت : <span>' . $role . '</span></div>                                <div class="infus">عکس ها : <span>' . htmlspecialchars($row['photonumber']) . '</span></div>                                <div class="infus">کد ملی : <span>' . htmlspecialchars($row['melicode']) . '</span></div>                                <div class="infus">نام کاربری : <span>' . htmlspecialchars($row['username']) . '</span></div>                                <div class="infus">ایمیل : <span class="en">' . htmlspecialchars($row['mail']) . '</span></div>                                <div class="infus none codem">' . htmlspecialchars($row['melicode']) . '</div>                                <div class="infus none tel">' . htmlspecialchars($row['tel']) . '</div>                                <div class="infus none addr">' . htmlspecialchars(str_replace(PHP_EOL, '<br>', $row['address'])) . '</div>                                <div class="infus none codp">' . htmlspecialchars($row['postcode']) . '</div>                            </div>                            <div class="card-action">                                ' . $isban . '                                <a class="moreinf tooltipped" data-position="bottom" data-delay="50" data-tooltip="اطلاعات بیشتر"><i class="mdi-navigation-more-vert small grey-text text-darken-4 right"></i></a>                            </div>                        </div>                    </div>';                    }                    $msgid = 1;                } else {                    $msgid = 0;                    $msgtxt = 'کاربر درخواستی یافت نشد!';                }            }        }        $data = array('id' => $msgid, 'msg' => $msgtxt);        $data = json_encode($data);        $this->view->render('adminuser/index', $data, false, 0);        return FALSE;    }}